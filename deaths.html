<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>End of world</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        .EC {
            width: 100vw;
            height: 100vh;
        }
        header{
            position: fixed;
            left: 0;
            top: 0;
            font-size:24px;
            color: white;
            z-index: 10;
            margin: 8px;
        }

        nav {
            position: fixed;
            right: 0;
            bottom: 0;
            z-index: 10;
            margin: 8px;
        }

        nav div {
            display: inline;
            color: white;

        }

        nav div.earthbtn {
            display: none;
        }

        nav div a {
            width: 100px;
            text-decoration: none;
            color: white;
            border: 1px solid #666;
            border-radius: 2px;
            padding: 10px 12px;
            margin-top: 6px;
            line-height: 14px;
            font-size: 14px;
            display: inline-block;
            text-align: center;
        }
    </style>
    <!--    cdn-->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@4.6.0/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts-gl@1.1.1/dist/echarts-gl.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/i18next@19.3.2/i18next.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@0.19.2/dist/axios.min.js"></script>

</head>
<body>
<header>
    COVID-19 deaths
</header>
<nav>
        <div><a href="index.html">COVID-19 confirmed</a></div>
<!--    <div><a href="deaths.html">COVID-19 deaths</a></div>-->
    <div><a href="recovered.html">COVID-19 recovered</a></div>
    <div ><a href="https://github.com/hugetiny/endofworld">Github</a></div>
    <!--    <div class="mutebtn"><a>Mute</a></div>-->
    <div class="earthbtn"><a>Earth</a></div>
</nav>
<div class="EC"></div>

<script>
    window.onload = () => {
        let data = []
        axios({
            method: 'get',
            url: 'https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Confirmed.csv'
        })
            .then(function (response) {
                console.log(response.data.split('\n'))
                response.data.split('\n').forEach(raw => {
                    if (raw.indexOf('"') !== -1) {
                        raw = raw.split('"')[2]
                    }
                    raw = raw.split(',')
                    data.push([parseFloat(raw[3]), parseFloat(raw[2]), parseFloat(raw[raw.length - 1])])

                })
                data.shift()
                console.log(data)
                let EC = echarts.init(document.querySelector('.EC'))
                let canvas = document.createElement('canvas');

                let mapChart = echarts.init(canvas, null, {
                    width: 4096,
                    height: 2160
                });

                mapChart.setOption({
                    series: [{
                        type: 'map',
                        map: 'world',
                        // full screen canvas
                        top: 0,
                        left: 0,
                        right: 0,
                        bottom: 0,
                        boundingCoords: [
                            [-180, 90],
                            [180, -90]
                        ]
                    }]
                });
                let option = {
                    // TODO category
                    visualMap: {
                        show: true,
                        min: 0,
                        max: 2000,
                        inRange: {
                            symbolSize: [1, 50]
                        }
                    },
                    globe: {
                        baseTexture: "./static/world.jpg",
                        heightTexture: "./static/world.jpg",
                        environment: 'static/starfield.jpg',
                        displacementScale: 0.03,
                        displacementQuality: 'high',
                        // globeRadius: 200,
                        globeOuterRadius: 110,
                        // baseColor: '#ccc',
                        shading: 'color',
                        viewControl: {
                            alpha: 30,
                            beta: 160,
                            // targetCoord: [116.46, 39.92],
                            autoRotate: true,
                            autoRotateAfterStill: 5,
                            distance: 300
                        }
                    },
                    series: {
                        type: 'scatter3D',
                        coordinateSystem: 'globe',
                        // blendMode: 'lighter',
                        symbolSize: 2,
                        itemStyle: {
                            color: 'grey',
                            opacity: 1
                        },
                        data: data
                    }
                }
                EC.setOption(option)
            })
            .catch(function (error) {
                console.log(error);
            });


        //TODO click events
        // mapChart.on('click', params => {
        //     let name = params.name
        //     let mapJson = 'https://raw.githubusercontent.com/Mying666/EC-JSON/gh-pages/json/' + name + '.json'
        //     EC.showLoading()
        //     $.getJSON(mapJson, geoJson => {
        //         // option.title.text = 'return?'
        //         option.series[1].map = name
        //         option.series[1].zlevel = 3
        //         echarts.registerMap(name, geoJson)
        //         // random example
        //         let data = []
        //         geoJson.features.forEach(d => {
        //             data.push({
        //                 name: d.properties.name,
        //                 value: (Math.random() * 3000).toFixed(2)
        //             })
        //         })
        //         option.series[1].data = data
        //         EC.setOption(option)
        //         $('.earthbtn').show()
        //         EC.hideLoading()
        //     })
        // })
        // $('.earthbtn').on('click', () => {
        //     // option.title.text = 'get back to earth'
        //     option.series[1].map = ''
        //     option.series[1].zlevel = 1
        //     EC.setOption(option)
        // })
    }
</script>

<audio id="bgm" autoplay>
    <source src="the%20end%20of%20the%20world.mp3" type="audio/mpeg">
    Your browser is too old
</audio>
<script>
    // bgm
    // var music = document.getElementById("bgm");
    // function toggleSound() {
    //     console.log(music);
    //     console.log(music.paused);
    //     if (music.paused) {
    //         music.paused=false;
    //         music.play();
    //     }
    // }
    // setTimeout("toggleSound()",5000);
    // $('.mutebtn').on('click',() => {
    //     music.pause();
    // })
</script>
</body>
</html>
