<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>End of world</title>
    <style>
        * {
            padding: 0;
            margin: 0;
        }

        .EC {
            width: 100vw;
            height: 100vh;
        }

        nav {
            position: fixed;
            right: 0;
            z-index: 10;
            margin: 8px;
        }

        nav div {
            display: inline;
            color: white;

        }

        nav div.earthbtn {
            display: none;
        }

        nav div a {
            width: 50px;
            text-decoration: none;
            color: white;
            border: 1px solid #666;
            border-radius: 2px;
            padding: 10px 12px;
            margin-top: 6px;
            line-height: 14px;
            font-size: 14px;
            display: inline-block;
            text-align: center;
        }
    </style>
    <!--    cdn-->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@4.6.0/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts-gl@1.1.1/dist/echarts-gl.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/i18next@19.3.2/i18next.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@0.19.2/dist/axios.min.js"></script>

</head>
<body>
<nav>
<!--    <div><a href="partition.html">next ver</a></div>-->
    <div><a href="https://github.com/hugetiny/endofworld">Github</a></div>
<!--    <div class="mutebtn"><a>Mute</a></div>-->
    <div class="earthbtn"><a>Earth</a></div>
</nav>
<div class="EC"></div>
<script>
    axios({
        method: 'get',
        url: 'https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_19-covid-Confirmed.csv',
        // data: {
        //     firstName: 'Fred',
        //     lastName: 'Flintstone'
        // }
    })
        .then(function (response) {
            console.log(response);
        })
        .catch(function (error) {
            console.log(error);
        });
    window.onload = () => {
        let EC = echarts.init(document.querySelector('.EC'))
        let canvas = document.createElement('canvas');
        // earth skin
        let mapChart = echarts.init(canvas, null, {
            // width: 4096,
            // height: 2160
            width: 2560,
            height: 1440
        });
        // $.getJSON('https://www.echartsjs.com/examples/data-gl/asset/data/population.json', function (data) {
        // function degToRad(degrees) {
        //     return degrees * (Math.PI / 180);
        // }
        //
        // function radToDeg(radians) {
        //     return radians * (180 / Math.PI)
        // }
        //
        // function latlngToXYZ ( coord, radius ){
        //     var sphereArray = [];
        //     var radius = radius||10;
        //     for(var i = 0; i < coord.length; i++) {
        //         var lat = degToRad(coord[i][0]);
        //         var lon = degToRad(coord[i][1]);
        //         var posY = radius * Math.sin(lat);
        //         var temp = radius * Math.cos(lat);
        //         var posX = temp * Math.sin(lon);
        //         var posZ = temp * Math.cos(lon);
        //
        //         sphereArray.push({x:posX,y:posY,z:posZ})
        //     }
        //     return sphereArray;
        // }
        // shanghai 31.201999999999998,121.4491


//上海
        let data = [[114,30,100]]
        // data = data.filter(function (dataItem) {
        //     return dataItem[2] > 0;
        // }).map(function (dataItem) {
        //     return [dataItem[0], dataItem[1], Math.sqrt(dataItem[2])];
        // });

        mapChart.setOption({
            series: [{
                type: 'map',
                map: 'world',
                // full screen canvas
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
                boundingCoords: [
                    [-180, 90],
                    [180, -90]
                ]
            }]
        });
        let option = {
            // TODO category
            visualMap: {
                show: false,
                min: 0,
                max: 60,
                inRange: {
                    symbolSize: [1.0, 10.0]
                }
            },
            globe: {
                baseTexture: "./static/world.jpg",
                heightTexture: "./static/world.jpg",
                environment: 'static/starfield.jpg',
                displacementScale: 0.03,
                displacementQuality: 'high',
                // globeRadius:100,
                globeOuterRadius: 100,
                // baseColor: '#ccc',
                shading: 'color',
                viewControl: {
                    alpha: 30,
                    beta: 160,
                    // targetCoord: [116.46, 39.92],
                    autoRotate: true,
                    autoRotateAfterStill: 5,
                    distance: 300
                }
            },
            series: {
                type: 'scatter3D',
                coordinateSystem: 'globe',
                // blendMode: 'lighter',
                symbolSize: 2,
                // itemStyle: {
                //     color: 'rgb(50, 50, 150)',
                //     opacity: 1
                // },
                data: data
            }
        }
        EC.setOption(option)
        //TODO click events
        // mapChart.on('click', params => {
        //     let name = params.name
        //     let mapJson = 'https://raw.githubusercontent.com/Mying666/EC-JSON/gh-pages/json/' + name + '.json'
        //     EC.showLoading()
        //     $.getJSON(mapJson, geoJson => {
        //         // option.title.text = 'return?'
        //         option.series[1].map = name
        //         option.series[1].zlevel = 3
        //         echarts.registerMap(name, geoJson)
        //         // random example
        //         let data = []
        //         geoJson.features.forEach(d => {
        //             data.push({
        //                 name: d.properties.name,
        //                 value: (Math.random() * 3000).toFixed(2)
        //             })
        //         })
        //         option.series[1].data = data
        //         EC.setOption(option)
        //         $('.earthbtn').show()
        //         EC.hideLoading()
        //     })
        // })
        // $('.earthbtn').on('click', () => {
        //     // option.title.text = 'get back to earth'
        //     option.series[1].map = ''
        //     option.series[1].zlevel = 1
        //     EC.setOption(option)
        // })
    }
</script>

<audio id="bgm" autoplay>
    <source src="the%20end%20of%20the%20world.mp3" type="audio/mpeg">
    Your browser is too old
</audio>
<script>
    // bgm
    var music = document.getElementById("bgm");
    function toggleSound() {
        console.log(music);
        console.log(music.paused);
        if (music.paused) {
            music.paused=false;
            music.play();
        }
    }
    setTimeout("toggleSound()",5000);
    $('.mutebtn').on('click',() => {

        music.pause();
    })
</script>
</body>
</html>
